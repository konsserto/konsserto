var fs = require('fs');
var glob = require('glob');

var namespaces = {};
var vendor = 'node_modules';
var src = 'src';
var libloader = 'ks-npm';
var fileloader = 'autoload_namespaces.js';
var pathfileloader = "../"+libloader+"/"+fileloader;
var pathlibloader = "../"+libloader+"/";



return glob("../**/"+src+"/**/*Bundle/*Bundle.*", function (er, files) {

	for (var index in files){
		var occurs = files[index].match('(.+)/'+src+'/(.+)/(.+)')
		if (occurs != undefined && occurs.length >= 4){
			var mlib = occurs[1].replace('..',vendor)+"/"+src+"/";
			var mroot = occurs[2];
			if (mroot.indexOf('/')>=0)
				mroot = mroot.substr(0,mroot.indexOf('/'))
			namespaces[mroot] = mlib
		}
	}
	try {
		fs.mkdirSync(pathlibloader,755)
	}
	catch(e){}

	file = fs.createWriteStream(pathfileloader)
	file.write("module.exports = "+JSON.stringify(namespaces)+";");
	file.close();
});



