CONFIG = use('/app/config/config')

class FactoryAdapter

  @getInstance: ()->
    adapter = undefined
    if FactoryAdapter.isConfigDbOk()
      if CONFIG.database.driver is 'mysql'
        adapter = use('@Konsserto/Component/EntityManager/Adapter/MysqlAdapter').getInstance()
      else
        if CONFIG.database.driver is 'mongodb'
          adapter = use('@Konsserto/Component/EntityManager/Adapter/MongodbAdapter').getInstance()
    return adapter

  @isConfigDbOk: ()->
    if CONFIG.database
      if !CONFIG.database.host
        console.log cc.red('[ERROR DATABASE] Missing Host')
        return false

      if !CONFIG.database.port
        console.log cc.red('[ERROR DATABASE] Missing Host')
        return false

      if !CONFIG.database.name
        console.log cc.red('[ERROR DATABASE] Missing database name')
        return false

      if !CONFIG.database.user
        console.log cc.red('[ERROR DATABASE] Missing database user')
        return false
      return true
    return false


module.exports = FactoryAdapter