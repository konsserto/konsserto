CONFIG = use('/app/config/config')

class EntityManager

  constructor: ()->
    @repositories = []
    @loadAdapter()


  getRepository: (repository)->
    splittedRepository = repository.split ':'

    vendor = splittedRepository[0]
    bundle = splittedRepository[1]
    realRepository = splittedRepository[2]

    returnRepository = new use('/src/' + vendor + '/' + bundle + '/Repositories/' + realRepository)
    returnRepository.setAdapter(@adapter)
    return returnRepository

  loadAdapter: ()->
    if CONFIG.database.driver is 'mysql'
      @adapter = new use('@Konsserto/Component/EntityManager/Adapter/MysqlAdapter')
    else
      if CONFIG.database.driver is 'mongodb'
        @adapter = new use('@Konsserto/Component/EntityManager/Adapter/MongodbAdapter')
      else
        @adapter = undefined


module.exports = EntityManager