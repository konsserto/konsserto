###
 * This file is part of the Konsserto package.
 *
 * (c) Jessym Reziga <jessym@konsserto.com>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
###

Bundle = use('@Konsserto/Component/Bundle/Bundle')
ConsoleApplication = use('@Konsserto/Component/Console/ConsoleApplication')
Kernel = use('@Konsserto/Component/HttpKernel/Kernel')

#
# Application is the main entry point of a ConsoleApplication
#
# @author Jessym Reziga <jessym@konsserto.com>
#
class Application extends ConsoleApplication


	constructor:(@kernel) ->
		@commandsRegistered = false
		super 'Konsserto',Kernel.VERSION
		
	# @return [String] returns ///
	getKernel:() ->
		return @kernel

	run:(input) ->
		@kernel.boot()
		@container = @kernel.container

		if !@commandsRegistered
			@registerCommands()
			@commandsRegistered = true

		for k,command of @commands
			command.setContainer(@container)

		return super input

	registerCommands:() ->
		bundles = @container.get('Application').getBundles()

		for bundleName,bundle of bundles
			if bundle instanceof Bundle
				bundle.registerCommands(this)


module.exports = Application

