###
 * This file is part of the Konsserto package.
 *
 * (c) Marvin Frachet <marvin@konsserto.com>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
###

# Rooms for socket.io
# @author Marvin Frachet <marvin@konsserto.com>
class Rooms

  # Class constructor
  constructor: ()->
    @rooms = []

  # Check if a room exists
  # @param {String} room Name of the room
  # @return {Boolean} True if exists, false in the other cases
  exists: (room)->
    if @rooms[room]
      return true
    return false

  # Check if a room contains a socket
  # @param {String} room Name of the room
  # @param {Object} socket The socket instance
  # @return {Boolean} True if contains, false in the other cases
  contains: (room, socket)->
    if @rooms[room]
      for r in @rooms[room]
        if socket.id == r.id
          return true
    return false

  # Make a socket join a room
  # @param {String} room Name of the room
  # @param {Object} socket The socket instance
  join: (room, socket)->
    @create room
    if !@contains room, socket
      socket.join room
      @rooms[room].push socket

  # Make a socket leave a room
  # @param {String} room Name of the room
  # @param {Object} socket The socket instance
  leave: (room, socket)->
    if @contains room, socket
      @rooms[room].splice @rooms[room].indexOf(socket), 1
      socket.leave room

  # Create a room
  # @param {String} room Name of the room
  create: (room)->
    if !@exists room
      @rooms[room] = []

  # Delete a room
  # @param {String} room Name of the room
  delete: (room)->
    if @exists room
      if @rooms[room].size == 0
        @rooms.splice @rooms.indexOf(room), 1

  # Get a room
  # @param {String} room Name of the room
  # @return {Object} room The room concerned
  get: (room)->
    if @exists room
      return @rooms[room]
    return undefined

  # Get all the rooms
  # @return [Object] The rooms
  getAll: ()->
    return @rooms

module.exports = Rooms
