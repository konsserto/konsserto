###
 * This file is part of the Konsserto package.
 *
 * (c) Jessym Reziga <jessym@konsserto.com>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
###

Tools = use('@Konsserto/Component/Static/Tools')

#
# SocketInstance
#
# @author Jessym Reziga <jessym@konsserto.com>
#
class SocketInstance


	constructor:(@socketDefinition, @controllerDefinition) ->
		@controller = new controllerDefinition
		socket = @getDefinition()
		console.log('[Socket] ' + @getControllerName()+':' + @getMethod() + ' | event: ' +socket.getRawEvent())

	setController:(@controller) ->
		return this

	setSocketDefinition:(@socketDefinition) ->
		return this

	setRequest:(@request) ->
		@getController().setRequest(@request)
		return this

	setResponse:(@response) ->
		@getController().setResponse(@response)
		return this

	setControllerDefinition:(@controllerDefinition) ->
		return this

	getDefinition:() ->
		return @socketDefinition

	getController:() ->
		return @controller

	getRequest:() ->
		return @request

	getResponse:() ->
		return @response

	getControllerDefinition:() ->
		return @controllerDefinition

	getControllerName:() ->
		return @getController().constructor.name

	getMethod:() ->
		return @getDefinition().getMethodName() + 'Action'

	methodExists:() ->
		method = @getMethod()

		if !method? || !@getController()[method]?
			return false

		return true

	getMethodArguments:() ->
		return []

	getMethodInstance:() ->
		if @getController()[@getMethod()]?
			return @getController()[@getMethod()]

		throw new Error('No method '+@getMethod()+' in controller '+@getDefinition().getControllerName())

	getResponse:() ->
		return Tools.call(@getMethodInstance(),@getMethodArguments())

	getControllerMethod:() ->
		return @getController()[@getMethod()]


module.exports = SocketInstance