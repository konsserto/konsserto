var io, should, spawn, startExample;

should = require('chai').should();

io = require('socket.io-client');

spawn = require('child_process').spawn;

startExample = function(appName, done, next) {
  var app;
  app = spawn('node', [appName]);
  return setTimeout(function() {
    return next(function() {
      app.kill('SIGKILL');
      return setTimeout(function() {
        return done();
      }, 1200);
    });
  }, 2000);
};

describe('the multi-process redis example', function() {
  return it('should work', function(next) {
    return startExample('../examples/scaling-with-redis/app', next, function(done) {
      var client;
      client = io.connect('http://localhost:7076', {
        'force new connection': true
      });
      return client.on('connect', function() {
        client.disconnect();
        return done();
      });
    });
  });
});
